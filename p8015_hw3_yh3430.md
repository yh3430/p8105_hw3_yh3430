P8105 homework 3
================
Yu He
10/14/2021

Load packages and dataset

``` r
library(tidyverse)
```

    ## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --

    ## v ggplot2 3.3.5     v purrr   0.3.4
    ## v tibble  3.1.4     v dplyr   1.0.7
    ## v tidyr   1.1.3     v stringr 1.4.0
    ## v readr   2.0.1     v forcats 0.5.1

    ## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

``` r
library(p8105.datasets)


knitr::opts_chunk$set(
  fig.width = 8,
  fig.asp = 1,
  out.width = "90%"
)
```

## Problem 1

Description of the dataset

The ‘instacart’ dataset is the order history of over 3 million online
orders collected from more than 200,000 instacart users. The dataset
includes order_id, product_id, add_to_cart_order, reordered, user_id,
eval_set, order_number, order_dow, order_hour_of_day,
days_since_prior_order, product_name, aisle_id, department_id, aisle,
department

``` r
data("instacart")
```

part 1 a, number of aisels - 134 items

``` r
instacart_df =
  force(instacart) %>% 
  group_by(aisle) %>% 
  summarize(n_obs = n())
```

part 1 b, top 3 items ordered in the aisles - fresh vegetables, fresh
fruits, and packaged vagetables fruits.

``` r
instacart_most_aisle =
  force(instacart) %>% 
  group_by(aisle) %>% 
  summarize(n_obs = n()) %>% 
  mutate(
    top_order_aisles = min_rank(n_obs)
  ) %>% 
  arrange(desc(n_obs)) %>% 
  filter(top_order_aisles > 131)
```

part 2 plot of number of items ordered in each aisles

``` r
instacart_df %>% 
  group_by(aisle) %>% 
  filter(as.numeric(n_obs) > 10000) %>% 
  ggplot(aes(x = n_obs, y = aisle)) +
  geom_point() +
  labs(
    title = "Instacart online items order more than 10,000",
    x = "number of orders",
    y = "item names",
    caption = "Data from The Instacart Online Grocery Shopping Dataset 2017"
  ) 
```

<img src="p8015_hw3_yh3430_files/figure-gfm/unnamed-chunk-5-1.png" width="90%" />

part 3 table of top three product in baking ingredients”, “dog food
care”, and “packaged vegetables fruits” listed in aisles.

``` r
pop_product = 
  instacart %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% 
  select(product_name, aisle) %>% 
  group_by(product_name, aisle) %>% 
  summarize(n_obs = n())
```

    ## `summarise()` has grouped output by 'product_name'. You can override using the `.groups` argument.

``` r
top3_bi = 
  pop_product %>% 
  filter(aisle == "baking ingredients") %>%
  mutate(
    prod_rank = min_rank(n_obs)
  ) %>% 
  arrange(desc(n_obs)) %>% 
  filter(n_obs > 329) %>% 
  select(-prod_rank)

top3_dfc =
  pop_product %>% 
    filter(aisle == "dog food care") %>%
  mutate(
    prod_rank = min_rank(n_obs)
  ) %>% 
  arrange(desc(n_obs)) %>% 
  filter(n_obs > 25) %>% 
  select(-prod_rank)

top3_pvf =
  pop_product %>% 
    filter(aisle == "packaged vegetables fruits") %>%
  mutate(
    prod_rank = min_rank(n_obs)
  ) %>% 
  arrange(desc(n_obs)) %>% 
  filter(n_obs > 4059) %>% 
  select(-prod_rank)

top3_product = bind_rows(top3_bi, top3_dfc, top3_pvf) %>% 
  knitr::kable()

top3_product
```

| product_name                                  | aisle                      | n_obs |
|:----------------------------------------------|:---------------------------|------:|
| Light Brown Sugar                             | baking ingredients         |   499 |
| Pure Baking Soda                              | baking ingredients         |   387 |
| Cane Sugar                                    | baking ingredients         |   336 |
| Snack Sticks Chicken & Rice Recipe Dog Treats | dog food care              |    30 |
| Organix Chicken & Brown Rice Recipe           | dog food care              |    28 |
| Small Dog Biscuits                            | dog food care              |    26 |
| Organic Baby Spinach                          | packaged vegetables fruits |  9784 |
| Organic Raspberries                           | packaged vegetables fruits |  5546 |
| Organic Blueberries                           | packaged vegetables fruits |  4966 |

part 4 table of Pink Lady Apples and Coffee Ice Cream

``` r
apple_cream_df =
  force(instacart) %>% 
  select(order_dow, order_hour_of_day, product_name) %>% 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
  mutate(order_dow = recode(order_dow, "0" = "Sunday", "1" = "Monday", "2" = "Tuesday", "3" = "Wednesday", "4" = "Thursday", "5" = "Friday", "6" = "Saturday")) %>% 
  group_by(order_dow, product_name) %>% 
  summarize(mean_order_hour = mean(order_hour_of_day)) %>% 
  pivot_wider(names_from = order_dow, values_from = mean_order_hour) %>% 
  knitr::kable()
```

    ## `summarise()` has grouped output by 'order_dow'. You can override using the `.groups` argument.

``` r
apple_cream_df
```

| product_name     |   Friday |   Monday | Saturday |   Sunday | Thursday |  Tuesday | Wednesday |
|:-----------------|---------:|---------:|---------:|---------:|---------:|---------:|----------:|
| Coffee Ice Cream | 12.26316 | 14.31579 | 13.83333 | 13.77419 | 15.21739 | 15.38095 |  15.31818 |
| Pink Lady Apples | 12.78431 | 11.36000 | 11.93750 | 13.44118 | 11.55172 | 11.70213 |  14.25000 |

## Problem 2

part 1 load, clean and manipulate the BRFSS data

factor(response, levels = c(“Poor”, “Fair”, “Good”, “Very good”,
“Excellent”))

``` r
data("brfss_smart2010") 
```

``` r
health_data_df =
  force(brfss_smart2010) %>% 
  janitor::clean_names() %>% 
  filter(topic == "Overall Health") %>% 
  filter(response %in% c("Poor", "Fair", "Good", "Very good", "Excellent")) %>% 
  group_by(response)  
```

part 2(a) states observation in 2002 and 2010

``` r
location_df =
  health_data_df %>% 
  filter(year %in% c("2002", "2010")) %>% 
  group_by(year, locationabbr) %>% 
  summarize(n_obs = n()) %>% 
  filter(n_obs > 6)
```

    ## `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.

part 2(b) plot of average value within a state over time

``` r
state_plot_df =
  health_data_df %>% 
  filter(response == "Excellent") %>% 
  select(year, locationabbr, locationdesc, data_value) %>% 
  group_by(year, locationabbr) %>% 
  summarize(mean_state_value = mean(data_value)) %>% 
  ggplot(aes(x = year, y = mean_state_value, group = locationabbr, color = locationabbr)) +
  geom_line(alpha = .7) +
   viridis::scale_color_viridis(
    name = "States",
    discrete = TRUE
  )
```

    ## Adding missing grouping variables: `response`

    ## `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.

``` r
state_plot_df
```

    ## Warning: Removed 3 row(s) containing missing values (geom_path).

<img src="p8015_hw3_yh3430_files/figure-gfm/unnamed-chunk-11-1.png" width="90%" />

part 2(c) two panel plot from 2006 and 2010 at NY, order issue relate to
problem 2 part 1

``` r
NY_data_df =
  health_data_df %>% 
  filter(locationabbr == "NY") %>% 
  filter(year %in% c("2006", "2010")) %>% 
  select(year, locationabbr,locationdesc, response, data_value) %>% 
  ggplot(aes(x = response, y = data_value, group = locationdesc, color = locationdesc)) +
  geom_point(alpha = .7) +
  facet_wrap(~ year) +
  labs(
    title = "BRFSS NY state data plot 2006 and 2010",
    caption = "Data from SMART project"
  ) +
  viridis::scale_color_viridis(
    name = "States",
    discrete = TRUE
  )
NY_data_df
```

<img src="p8015_hw3_yh3430_files/figure-gfm/unnamed-chunk-12-1.png" width="90%" />

## Problem 3

part 1 load and manipulate data

``` r
accel_data =
  read_csv("accel_data.csv") %>% 
  janitor::clean_names()
```

    ## Rows: 35 Columns: 1443

    ## -- Column specification --------------------------------------------------------
    ## Delimiter: ","
    ## chr    (1): day
    ## dbl (1442): week, day_id, activity.1, activity.2, activity.3, activity.4, ac...

    ## 
    ## i Use `spec()` to retrieve the full column specification for this data.
    ## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
